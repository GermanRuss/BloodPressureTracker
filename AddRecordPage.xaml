<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:BloodPressureTracker.ViewModels"
             x:Class="BloodPressureTracker.Views.AddRecordPage"
             x:DataType="viewmodels:AddRecordViewModel"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="InputBorder" TargetType="Border">
                <Setter Property="Padding" Value="15"/>
                <Setter Property="StrokeThickness" Value="1"/>
                <Setter Property="StrokeShape" Value="RoundRectangle 8"/>
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#F5F5F5, Dark=#2A2A2A}"/>
                <Setter Property="Stroke" Value="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"/>
            </Style>

            <Style x:Key="TimeSlotHeader" TargetType="Label">
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="Margin" Value="0,10,0,5"/>
            </Style>

            <Style x:Key="InputLabel" TargetType="Label">
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="VerticalOptions" Value="Center"/>
                <Setter Property="WidthRequest" Value="80"/>
            </Style>

            <Style x:Key="NumberEntry" TargetType="Entry">
                <Setter Property="Keyboard" Value="Numeric"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="Placeholder" Value="--"/>
                <Setter Property="HorizontalTextAlignment" Value="Center"/>
                <Setter Property="WidthRequest" Value="60"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Отмена" Command="{Binding CancelCommand}"/>
        <ToolbarItem Text="Сохранить" Command="{Binding SaveCommand}"/>
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Spacing="15" Padding="20">

            <!-- Дата измерения -->
            <Border Style="{StaticResource InputBorder}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Дата измерения" Style="{StaticResource TimeSlotHeader}"/>
                    <DatePicker Date="{Binding SelectedDate}"
                                Format="dd.MM.yyyy"
                                FontSize="16"/>
                </VerticalStackLayout>
            </Border>

            <!-- Утренние измерения -->
            <Border Style="{StaticResource InputBorder}">
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Grid.Column="0" Text="Утренние измерения" Style="{StaticResource TimeSlotHeader}"/>
                        <Button Grid.Column="1" Text="Очистить" 
                                Command="{Binding ClearMorningCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource DangerColor}"
                                HorizontalOptions="End"/>
                    </Grid>

                    <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" 
                          RowDefinitions="Auto,Auto,Auto"
                          ColumnSpacing="10" RowSpacing="15">

                        <!-- Систолическое -->
                        <Label Text="Систолическое:" Grid.Column="0" Grid.Row="0" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding MorningSystolic}" Grid.Column="1" Grid.Row="0"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="мм рт.ст." Grid.Column="2" Grid.Row="0"
                               FontSize="12" VerticalOptions="Center"/>

                        <!-- Диастолическое -->
                        <Label Text="Диастолическое:" Grid.Column="3" Grid.Row="0" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding MorningDiastolic}" Grid.Column="4" Grid.Row="0"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="мм рт.ст." Grid.Column="5" Grid.Row="0"
                               FontSize="12" VerticalOptions="Center"/>

                        <!-- Пульс -->
                        <Label Text="Пульс:" Grid.Column="0" Grid.Row="1" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding MorningPulse}" Grid.Column="1" Grid.Row="1"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="уд/мин" Grid.Column="2" Grid.Row="1"
                               FontSize="12" VerticalOptions="Center"/>

                        <!-- Статус валидации -->
                        <Label Text="{Binding MorningValidationStatus}"
                               Grid.Column="3" Grid.ColumnSpan="3" Grid.Row="1"
                               FontSize="12" TextColor="{Binding MorningValidationColor}"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Обеденные измерения -->
            <Border Style="{StaticResource InputBorder}">
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Grid.Column="0" Text="Обеденные измерения" Style="{StaticResource TimeSlotHeader}"/>
                        <Button Grid.Column="1" Text="Очистить" 
                                Command="{Binding ClearAfternoonCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource DangerColor}"
                                HorizontalOptions="End"/>
                    </Grid>

                    <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" 
                          RowDefinitions="Auto,Auto,Auto"
                          ColumnSpacing="10" RowSpacing="15">

                        <Label Text="Систолическое:" Grid.Column="0" Grid.Row="0" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding AfternoonSystolic}" Grid.Column="1" Grid.Row="0"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="мм рт.ст." Grid.Column="2" Grid.Row="0"
                               FontSize="12" VerticalOptions="Center"/>

                        <Label Text="Диастолическое:" Grid.Column="3" Grid.Row="0" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding AfternoonDiastolic}" Grid.Column="4" Grid.Row="0"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="мм рт.ст." Grid.Column="5" Grid.Row="0"
                               FontSize="12" VerticalOptions="Center"/>

                        <Label Text="Пульс:" Grid.Column="0" Grid.Row="1" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding AfternoonPulse}" Grid.Column="1" Grid.Row="1"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="уд/мин" Grid.Column="2" Grid.Row="1"
                               FontSize="12" VerticalOptions="Center"/>

                        <Label Text="{Binding AfternoonValidationStatus}"
                               Grid.Column="3" Grid.ColumnSpan="3" Grid.Row="1"
                               FontSize="12" TextColor="{Binding AfternoonValidationColor}"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Вечерние измерения -->
            <Border Style="{StaticResource InputBorder}">
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Grid.Column="0" Text="Вечерние измерения" Style="{StaticResource TimeSlotHeader}"/>
                        <Button Grid.Column="1" Text="Очистить" 
                                Command="{Binding ClearEveningCommand}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource DangerColor}"
                                HorizontalOptions="End"/>
                    </Grid>

                    <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" 
                          RowDefinitions="Auto,Auto,Auto"
                          ColumnSpacing="10" RowSpacing="15">

                        <Label Text="Систолическое:" Grid.Column="0" Grid.Row="0" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding EveningSystolic}" Grid.Column="1" Grid.Row="0"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="мм рт.ст." Grid.Column="2" Grid.Row="0"
                               FontSize="12" VerticalOptions="Center"/>

                        <Label Text="Диастолическое:" Grid.Column="3" Grid.Row="0" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding EveningDiastolic}" Grid.Column="4" Grid.Row="0"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="мм рт.ст." Grid.Column="5" Grid.Row="0"
                               FontSize="12" VerticalOptions="Center"/>

                        <Label Text="Пульс:" Grid.Column="0" Grid.Row="1" 
                               Style="{StaticResource InputLabel}"/>
                        <Entry Text="{Binding EveningPulse}" Grid.Column="1" Grid.Row="1"
                               Style="{StaticResource NumberEntry}"/>
                        <Label Text="уд/мин" Grid.Column="2" Grid.Row="1"
                               FontSize="12" VerticalOptions="Center"/>

                        <Label Text="{Binding EveningValidationStatus}"
                               Grid.Column="3" Grid.ColumnSpan="3" Grid.Row="1"
                               FontSize="12" TextColor="{Binding EveningValidationColor}"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Комментарий -->
            <Border Style="{StaticResource InputBorder}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Комментарий" Style="{StaticResource TimeSlotHeader}"/>
                    <Editor Text="{Binding Notes}"
                            AutoSize="TextChanges"
                            MinimumHeightRequest="80"
                            Placeholder="Дополнительные заметки..."
                            FontSize="14"/>
                </VerticalStackLayout>
            </Border>

            <!-- Кнопки действий -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button Grid.Column="0" 
                        Text="Отмена" 
                        Command="{Binding CancelCommand}"
                        Style="{StaticResource SecondaryButton}"/>

                <Button Grid.Column="1" 
                        Text="Сохранить" 
                        Command="{Binding SaveCommand}"
                        Style="{StaticResource PrimaryButton}"/>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>