<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:BloodPressureTracker.ViewModels"
             xmlns:models="clr-namespace:BloodPressureTracker.Models"
             xmlns:converters="clr-namespace:BloodPressureTracker.Converters"
             x:Class="BloodPressureTracker.Views.MainPage"
             x:DataType="viewmodels:MainViewModel"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:DayOfWeekConverter x:Key="DayOfWeekConverter"/>

            <Color x:Key="PrimaryColor">#2196F3</Color>
            <Color x:Key="SecondaryColor">#4CAF50</Color>
            <Color x:Key="WarningColor">#FF9800</Color>
            <Color x:Key="DangerColor">#F44336</Color>

            <Style x:Key="CardStyle" TargetType="Border">
                <Setter Property="Padding" Value="15"/>
                <Setter Property="StrokeThickness" Value="1"/>
                <Setter Property="StrokeShape" Value="RoundRectangle 10"/>
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=White, Dark=#1E1E1E}"/>
                <Setter Property="Stroke" Value="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"/>
            </Style>

            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource PrimaryColor}"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Padding" Value="20,10"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>

            <Style x:Key="SecondaryButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="TextColor" Value="{StaticResource PrimaryColor}"/>
                <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}"/>
                <Setter Property="BorderWidth" Value="1"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Padding" Value="20,10"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem IconImageSource="refresh.png" Command="{Binding RefreshAsyncCommand}"/>
    </ContentPage.ToolbarItems>

    <RefreshView IsRefreshing="{Binding IsBusy}"
                 Command="{Binding RefreshAsyncCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="20" Padding="20">

                <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÑÐµÐ³Ð¾Ð´Ð½Ñ -->
                <Border Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="10">
                        <HorizontalStackLayout>
                            <Label Text="Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ"
                                   FontSize="20"
                                   FontAttributes="Bold"/>
                            <Label Text="{Binding SelectedDate, StringFormat='{0:dd.MM.yyyy}'}"
                                   FontSize="14"
                                   VerticalOptions="Center"
                                   Margin="10,0,0,0"/>
                        </HorizontalStackLayout>

                        <BoxView HeightRequest="1"
                                 Color="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"/>

                        <HorizontalStackLayout Spacing="20">
                            <!-- Ð£Ñ‚Ñ€Ð¾ -->
                            <VerticalStackLayout Spacing="5">
                                <Label Text="Ð£Ñ‚Ñ€Ð¾" FontSize="12" TextColor="Gray"/>
                                <Label Text="{Binding TodayRecord.MorningPressureDisplay}"
                                       FontSize="18"
                                       FontAttributes="Bold"/>
                            </VerticalStackLayout>

                            <!-- ÐžÐ±ÐµÐ´ -->
                            <VerticalStackLayout Spacing="5">
                                <Label Text="ÐžÐ±ÐµÐ´" FontSize="12" TextColor="Gray"/>
                                <Label Text="{Binding TodayRecord.AfternoonPressureDisplay}"
                                       FontSize="18"
                                       FontAttributes="Bold"/>
                            </VerticalStackLayout>

                            <!-- Ð’ÐµÑ‡ÐµÑ€ -->
                            <VerticalStackLayout Spacing="5">
                                <Label Text="Ð’ÐµÑ‡ÐµÑ€" FontSize="12" TextColor="Gray"/>
                                <Label Text="{Binding TodayRecord.EveningPressureDisplay}"
                                       FontSize="18"
                                       FontAttributes="Bold"/>
                            </VerticalStackLayout>
                        </HorizontalStackLayout>

                        <BoxView HeightRequest="1"
                                 Color="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"/>

                        <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                            <Border Grid.Column="0"
                                   BackgroundColor="{Binding StatusColor}"
                                   StrokeThickness="0"
                                   StrokeShape="RoundRectangle 15"
                                   Padding="10,5">
                                <Label Text="{Binding TodayStatus}"
                                       TextColor="White"
                                       FontSize="12"/>
                            </Border>

                            <Button Grid.Column="1"
                                    Text="âž• Ð—Ð°Ð¿Ð¸ÑÑŒ"
                                    Command="{Binding AddRecordCommand}"
                                    Style="{StaticResource SecondaryButton}"
                                    HorizontalOptions="End"/>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="*,*" ColumnSpacing="10" RowSpacing="10">

                    <Border Grid.Column="0" Grid.Row="0" Style="{StaticResource CardStyle}">
                        <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Image Source="history.png" HeightRequest="40" WidthRequest="40"/>
                            <Label Text="Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ" FontSize="14" HorizontalOptions="Center"/>
                            <Button Text="ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€"
                                    Command="{Binding ViewHistoryCommand}"
                                    Style="{StaticResource SecondaryButton}"/>
                        </VerticalStackLayout>
                    </Border>

                    <Border Grid.Column="1" Grid.Row="0" Style="{StaticResource CardStyle}">
                        <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Image Source="chart.png" HeightRequest="40" WidthRequest="40"/>
                            <Label Text="Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°" FontSize="14" HorizontalOptions="Center"/>
                            <Button Text="ÐÐ½Ð°Ð»Ð¸Ð·"
                                    Command="{Binding ViewStatisticsCommand}"
                                    Style="{StaticResource SecondaryButton}"/>
                        </VerticalStackLayout>
                    </Border>

                    <Border Grid.Column="0" Grid.Row="1" Style="{StaticResource CardStyle}">
                        <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Image Source="export.png" HeightRequest="40" WidthRequest="40"/>
                            <Label Text="Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚" FontSize="14" HorizontalOptions="Center"/>
                            <Button Text="PDF"
                                    Command="{Binding ExportDataCommand}"
                                    Style="{StaticResource SecondaryButton}"/>
                        </VerticalStackLayout>
                    </Border>

                    <Border Grid.Column="1" Grid.Row="1" Style="{StaticResource CardStyle}">
                        <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Image Source="settings.png" HeightRequest="40" WidthRequest="40"/>
                            <Label Text="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸" FontSize="14" HorizontalOptions="Center"/>
                            <Button Text="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ"
                                    Command="{Binding ViewSettingsCommand}"
                                    Style="{StaticResource SecondaryButton}"/>
                        </VerticalStackLayout>
                    </Border>

                </Grid>

                <!-- ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸ -->
                <Border Style="{StaticResource CardStyle}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸"
                               FontSize="18"
                               FontAttributes="Bold"/>

                        <BoxView HeightRequest="1"
                                 Color="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"/>

                        <CollectionView ItemsSource="{Binding RecentRecords}"
                                        EmptyView="ÐÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹">

                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="models:BloodPressureRecord">
                                    <Border Style="{StaticResource CardStyle}" Margin="0,0,0,10">
                                        <Grid ColumnDefinitions="*,Auto"
                                              RowDefinitions="Auto,Auto,Auto,Auto">

                                            <!-- Ð”Ð°Ñ‚Ð° Ð¸ Ð´ÐµÐ½ÑŒ Ð½ÐµÐ´ÐµÐ»Ð¸ -->
                                            <VerticalStackLayout Grid.Column="0" Grid.Row="0">
                                                <Label Text="{Binding Date, StringFormat='{0:dd.MM.yyyy}'}"
                                                       FontSize="16"
                                                       FontAttributes="Bold"/>
                                                <Label Text="{Binding Date, Converter={StaticResource DayOfWeekConverter}}"
                                                       FontSize="12"
                                                       TextColor="Gray"/>
                                            </VerticalStackLayout>

                                            <!-- Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
                                            <HorizontalStackLayout Grid.Column="1" Grid.Row="0"
                                                                   Spacing="5">
                                                <Button Text="âœï¸"
                                                        FontSize="12"
                                                        BackgroundColor="Transparent"
                                                        Padding="5"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, 
                                                                 Path=EditRecordCommand}"
                                                        CommandParameter="{Binding .}"/>
                                                <Button Text="ðŸ—‘ï¸"
                                                        FontSize="12"
                                                        BackgroundColor="Transparent"
                                                        Padding="5"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, 
                                                                 Path=DeleteRecordCommand}"
                                                        CommandParameter="{Binding .}"/>
                                            </HorizontalStackLayout>

                                            <!-- Ð£Ñ‚Ñ€Ð¾ -->
                                            <Grid Grid.Column="0" Grid.Row="1"
                                                  ColumnDefinitions="Auto,*,Auto"
                                                  Margin="0,10,0,0">
                                                <Label Text="Ð£Ñ‚Ñ€Ð¾:"
                                                       Grid.Column="0"
                                                       FontSize="12"
                                                       TextColor="Gray"/>
                                                <Label Text="{Binding MorningPressureDisplay}"
                                                       Grid.Column="1"
                                                       FontSize="14"
                                                       Margin="10,0,0,0"/>
                                                <Label Text="{Binding PulseMorning, StringFormat='ÐŸÑƒÐ»ÑŒÑ: {0}'}"
                                                       Grid.Column="2"
                                                       FontSize="12"
                                                       TextColor="Gray"/>
                                            </Grid>

                                            <!-- ÐžÐ±ÐµÐ´ -->
                                            <Grid Grid.Column="0" Grid.Row="2"
                                                  ColumnDefinitions="Auto,*,Auto"
                                                  Margin="0,5,0,0">
                                                <Label Text="ÐžÐ±ÐµÐ´:"
                                                       Grid.Column="0"
                                                       FontSize="12"
                                                       TextColor="Gray"/>
                                                <Label Text="{Binding AfternoonPressureDisplay}"
                                                       Grid.Column="1"
                                                       FontSize="14"
                                                       Margin="10,0,0,0"/>
                                                <Label Text="{Binding PulseAfternoon, StringFormat='ÐŸÑƒÐ»ÑŒÑ: {0}'}"
                                                       Grid.Column="2"
                                                       FontSize="12"
                                                       TextColor="Gray"/>
                                            </Grid>

                                            <!-- Ð’ÐµÑ‡ÐµÑ€ -->
                                            <Grid Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="3"
                                                  ColumnDefinitions="Auto,*,Auto"
                                                  Margin="0,5,0,0">
                                                <Label Text="Ð’ÐµÑ‡ÐµÑ€:"
                                                       Grid.Column="0"
                                                       FontSize="12"
                                                       TextColor="Gray"/>
                                                <Label Text="{Binding EveningPressureDisplay}"
                                                       Grid.Column="1"
                                                       FontSize="14"
                                                       Margin="10,0,0,0"/>
                                                <Label Text="{Binding PulseEvening, StringFormat='ÐŸÑƒÐ»ÑŒÑ: {0}'}"
                                                       Grid.Column="2"
                                                       FontSize="12"
                                                       TextColor="Gray"/>
                                            </Grid>

                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>